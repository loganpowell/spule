<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>spule - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-constants.html">constants</a></li><li><a href="module-registerCMD.html">registerCMD</a></li><li><a href="module-spule.html">spule</a></li><li><a href="module-Streams.html">Streams</a></li></ul><h3>Global</h3><ul><li><a href="global.html#__HREF_PUSHSTATE_DOM">__HREF_PUSHSTATE_DOM</a></li><li><a href="global.html#__NOTIFY_PRERENDER_DOM">__NOTIFY_PRERENDER_DOM</a></li><li><a href="global.html#__SET_LINK_ATTRS_DOM">__SET_LINK_ATTRS_DOM</a></li><li><a href="global.html#__URL__ROUTE">__URL__ROUTE</a></li><li><a href="global.html#__URL_DOM__ROUTE">__URL_DOM__ROUTE</a></li><li><a href="global.html#diff_keys">diff_keys</a></li><li><a href="global.html#err_str">err_str</a></li><li><a href="global.html#FLIPFirst">FLIPFirst</a></li><li><a href="global.html#FLIPLastInvertPlay">FLIPLastInvertPlay</a></li><li><a href="global.html#fURL">fURL</a></li><li><a href="global.html#HURLer">HURLer</a></li><li><a href="global.html#set$$tate">set$$tate</a></li><li><a href="global.html#state">state</a></li><li><a href="global.html#stringify_type">stringify_type</a></li><li><a href="global.html#stringify_w_functions">stringify_w_functions</a></li><li><a href="global.html#trace$">trace$</a></li><li><a href="global.html#unfURL">unfURL</a></li><li><a href="global.html#x_key_ERR">x_key_ERR</a></li><li><a href="global.html#zIndex">zIndex</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">spule</h1>
    

    




<section>

<header>
    
        
    
</header>

<article>
    
        <div class="container-overview">
        
            

            
        
        </div>
    

    

    

    
    
    

     

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id=".spule"><span class="type-signature">(static, constant) </span>spule<span class="type-signature"></span></h4>





<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="spule_spule.js.html">spule/spule.js</a>, <a href="spule_spule.js.html#line186">line 186</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h2><code>spool</code></h2>
<h3>TL;DR:</h3>
<p>Handles Collections (array) of Commands (&quot;Tasks&quot;) which
require <em>ordered</em> choreography and/or have a dependency
on some (a)sync data produced by a user interaction.</p>
<h3>Synopsis:</h3>
<ul>
<li>Async <code>reduce</code> function, that passes an accumulator
(<code>acc</code>) as a local state container between Command
invocations.</li>
<li>Commands are composed in-situ in userland (Ad hoc)</li>
<li>spools a collection of Commands as a Task</li>
<li>resolves any promises contained within a Command</li>
<li>passes an accumulator (acc) to subsequent Commands in a
Task</li>
</ul>
<h3>Type checks on function signatures</h3>
<p>There are two valid forms for Task entries:</p>
<ol>
<li>a Unary function returning an array of Commands:
referred to as &quot;Subtasks&quot;</li>
<li>A Command object: dispatch to registered handlers</li>
</ol>
<h2>Recognized Keys</h2>
<p>There are 4 recognized keys for a Command object:</p>
<h3>Primary keys</h3>
<h5><code>sub$</code> key</h5>
<ul>
<li>Topic identifier: used for registering handlers hooked
onto the Command stream.</li>
</ul>
<h5><code>args</code> key</h5>
<ul>
<li><strong>primary control structure</strong> with three recognized
forms that do different things in the context of a
Task:</li>
<li>non-function <code>args</code> (primitives, objects) send the args
as-is to the Command handler</li>
<li>nullary fns (<code>(0)=&gt;</code> ) send the args_ as a Command to
a <code>sub$</code> <em>stream</em> of your choosing (ADVANCED: see
Ad-hoc Stream Injection below)</li>
<li>unary fns (<code>(1)=&gt;</code>) are passed the inter-Task
accumulated value, called and the resulting value is
passed to registered Command handler</li>
<li>Promises (and those returned from <code>(1)=&gt;</code>) are resolved
and their values sent to the handler</li>
<li>new vals (Objects) are merged with accumulated object
from preceding Task results(dupe keys overwritten)</li>
</ul>
<h3>Promise-specific keys -&gt; binary (as in two parameter,</h3>
<p>not boolean) functions:</p>
<h5><code>reso</code> key</h5>
<ul>
<li>(resolving) function <code>(2)=&gt;</code> = handle resolved
promises: MUST be a binary fn <code>(acc, resolved Promise) =&gt;</code></li>
</ul>
<h5><code>erro</code> key</h5>
<ul>
<li><code>(2)=&gt;</code> = handle rejected promises: MUST be
a binary fn <code>(acc, Promise rejection) =&gt;</code></li>
</ul>
<h3>Subtasks:</h3>
<p>Subtasks are the way you compose tasks. Insert a Task and
the spool will unpack it in place (super -&gt; sub
order preserved) A Subtask must be defined as a unary
function that accepts an accumulator object and returns a
Task, e.g.:</p>
<h4>PSEUDO</h4>
<pre class="prettyprint source lang-js"><code>// { C: Command }
// ( { A: Accumulator }: Object ) => [{C},{C}]: Subtask
let someSubtask = ({A}) => [{C}, {C}, ({A})=>[{C},{C}], ...]
</code></pre>
<h4>Example</h4>
<pre class="prettyprint source lang-js"><code>// subtask example:
let subtask1 = acc => [
 { sub$: &quot;acc&quot;
 , args: { data: acc.data } },
 { sub$: &quot;route&quot;
 , args: { route: { href: acc.href } } }
]

// task
let task = [
 { args: { href: &quot;https://my.io/todos&quot; } }, // acc init
 { sub$: &quot;fetch&quot;
 , args: ({ href }) => fetch(href).then(r => r.json())
 , erro: (acc, err) => ({ sub$: &quot;cancel&quot;, args: err })
 , reso: (acc, res) => ({ data: res }) },
 acc => subtask1(acc), // subtask reference
 { sub$: &quot;FLIP&quot; , args: &quot;done&quot; }
]

</code></pre>
<h4>Use:</h4>
<pre class="prettyprint source lang-js"><code>import { run$ } from &quot;hurl&quot;

export const run = e => run$.next(e);

//... ðŸ“Œ TODO...
</code></pre>
<h3>Ad-hoc stream injection</h3>
<p>ADVANCED USE ONLY ðŸ‘½</p>
<p>HURL tries to hide the stream implentation from the user
as much as possible, but allows you to go further down
the rabbit hole if so desired. You may send Commands to a
separate stream of your own creation during a Task by
using a nullary (&quot;thunk&quot;) <code>(0)=&gt;</code> function signature as
the <code>args</code> value of a Command. If this is the case, the
spool assumes the <code>sub$</code> key references a stream and
sends the return value of the thunk to that stream</p>
<blockquote>
<p>Note: if you need to pass the accumulator to your
thunk, put it in a subtask, where you can
access/destructure the data from the acc passed into the
subtask function</p>
</blockquote>
<pre class="prettyprint source lang-js"><code>import { stream, trace } from &quot;@thi.ng/rstream&quot;

// ad-hoc stream
let login = stream().subscribe(trace(&quot;login ->&quot;))

// task
let task = [
 { args: { href: &quot;https://my.io/auth&quot; } }, // &lt;- no sub$, just pass data
 { sub$: login , args: () => &quot;logging in...&quot; },
 { sub$: &quot;AUTH&quot;
 , args: ({ href }) => fetch(href).then(r => r.json())
 , erro: (acc, err) => ({ sub$: &quot;cancel&quot;, args: err })
 , reso: (acc, res) => ({ token: res }) },
 acc => subtask_login(acc),
 { sub$: login , args: () => &quot;log in success&quot; }
]

// subtask
let subtask_login = ({ token }) => [
 { sub$: login // &lt;- stream
 , args: () => ({ token }) } // &lt;- use acc
]
</code></pre>
</div>








        
    

    

    

    
</article>

</section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Sun Feb 02 2020 21:34:51 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>