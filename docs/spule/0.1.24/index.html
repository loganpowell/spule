<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      Home - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li  class="active" >
        <a href="index.html">
          
          
            <svg fill="#0095dd" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      HURL Documentation
    </h3>

    
      <h3>
        Resources
      </h3>
      
        <a href="http://thi.ng/umbrella">@thi.ng/umbrella</a>
      
    

    <h3>Modules</h3><ul><li id="registerCMD-nav"><a href="module-registerCMD.html">registerCMD</a></li><li id="spule-nav"><a href="module-spule.html">spule</a></li><li id="constants-nav"><a href="module-constants.html">constants</a></li><li id="Streams-nav"><a href="module-Streams.html">Streams</a></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#FLIPFirst">FLIPFirst</a></li><li><a href="global.html#zIndex">zIndex</a></li><li><a href="global.html#FLIPLastInvertPlay">FLIPLastInvertPlay</a></li><li><a href="global.html#state">state</a></li><li><a href="global.html#HURLer">HURLer</a></li><li><a href="global.html#__SET_LINK_ATTRS_DOM">__SET_LINK_ATTRS_DOM</a></li><li><a href="global.html#__HREF_PUSHSTATE_DOM">__HREF_PUSHSTATE_DOM</a></li><li><a href="global.html#__NOTIFY_PRERENDER_DOM">__NOTIFY_PRERENDER_DOM</a></li><li><a href="global.html#err_str">err_str</a></li><li><a href="global.html#set$$tate">set$$tate</a></li><li><a href="global.html#__URL__ROUTE">__URL__ROUTE</a></li><li><a href="global.html#__URL_DOM__ROUTE">__URL_DOM__ROUTE</a></li><li><a href="global.html#diff_keys">diff_keys</a></li><li><a href="global.html#stringify_type">stringify_type</a></li><li><a href="global.html#trace$">trace$</a></li><li><a href="global.html#fURL">fURL</a></li><li><a href="global.html#unfURL">unfURL</a></li><li><a href="global.html#stringify_w_functions">stringify_w_functions</a></li><li><a href="global.html#x_key_ERR">x_key_ERR</a></li></ul>
  </nav>

  <div id="main">
    

    
      



    

      


  <section class="readme">
    <article>
      <h2>Outline</h2>
<ul>
<li>Intro:
<ul>
<li>Data-oriented javascript framework built from <a href="http://thi.ng/umbrella">@thi.ng/umbrella</a> libraries</li>
<li>Other frameworks:
<ul>
<li>too much boilerplate</li>
<li>too much context switching when adding functionality (directory duck duck goose)</li>
<li>large API surface areas</li>
<li>Poor <a href="">&quot;reasonaboutability&quot;</a></li>
</ul>
</li>
<li>This is simpler:
<ul>
<li>upstream (producers) &amp;&amp; downstream (consumers)</li>
<li>async is built in (no middleware required)</li>
<li>Elm/Flux inspired uni-directional data flow
<ul>
<li>via <a href="">FRP</a> under the hood</li>
<li>direct stream participation opt-in only- i.e., not necessary for common needs</li>
</ul>
</li>
<li>Complex asynchronous action coreography is handled for the user by the framework</li>
<li>Learning curve is basically five function signatures (within Tasks, more later)</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>IMAGE(s) of a socket and a light switch. You plug in a light and turn it on with a switch...</li>
</ul>
<ul>
<li>♻ Framework Architecture</li>
</ul>
<h3>Command Keys</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Role(s)</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sub$</code></td>
<td>String</td>
<td>Topic ID: connects Command to handler</td>
<td>[DP]/[RG]</td>
</tr>
<tr>
<td><code>args</code></td>
<td>Any</td>
<td>Payload or payload function</td>
<td>[AH]</td>
</tr>
<tr>
<td><code>path</code></td>
<td>Any</td>
<td>Lens for global state evolution</td>
<td>[ST]</td>
</tr>
<tr>
<td><code>handler</code></td>
<td>Function</td>
<td>Dispatches on Command (side effects)</td>
<td>[RG]</td>
</tr>
<tr>
<td><code>source$</code></td>
<td>Stream</td>
<td>Upstream Command &quot;Feeder&quot;</td>
<td>[AH]</td>
</tr>
<tr>
<td><code>reso</code></td>
<td>Function</td>
<td>Promise resolution handler</td>
<td>[PR]</td>
</tr>
<tr>
<td><code>erro</code></td>
<td>Function</td>
<td>Promise rejection handler</td>
<td>[PR]</td>
</tr>
</tbody>
</table>
<h5>RG: Command <em>Registration</em></h5>
<h5>DP: Command <em>Dispatch</em></h5>
<h5>PR: Commands Containing <em>Promises</em> (during dispatch)</h5>
<h5>AH: <em>Ad-hoc</em> Configuration of Command Dispatch</h5>
<h5>ST: Global <em>State</em> evolution (lens)</h5>
<p><a href="">lensed</a></p>
<h3>Symbols Glossary</h3>
<table>
<thead>
<tr>
<th>Symbol</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(#) =&gt;</code></td>
<td>[function with <code>#</code> (number) parameters]</td>
</tr>
<tr>
<td><code>PRI</code></td>
<td>Primitive value (boolean, string, number)</td>
</tr>
<tr>
<td><code>{?}</code></td>
<td>Object</td>
</tr>
<tr>
<td><code>{P}</code></td>
<td>Promise</td>
</tr>
<tr>
<td><code>{C}</code></td>
<td>[Command object]</td>
</tr>
<tr>
<td><code>{A}</code></td>
<td>[Accumulator object]</td>
</tr>
<tr>
<td><code>[{C},{C}]</code> / <code>[T]</code></td>
<td>[Task array]</td>
</tr>
<tr>
<td><code>(A) =&gt; [T]</code></td>
<td>[Subtask]</td>
</tr>
</tbody>
</table>
<p><a href="#intra-task-accumulator">function with <code>#</code> (number) parameters</a>
<a href="#commands">Command object</a><br>
<a href="#intra-task-accumulator">Accumulator object</a><br>
<a href="#tasks">Task array</a><br>
<a href="#subtasks">Subtask</a></p>
<ul>
<li>
<p>Commands</p>
</li>
<li>
<p>Tasks</p>
</li>
<li>
<p>Subtasks</p>
</li>
<li>
<p>Intra-Task Accumulator</p>
<ul>
<li>Cross-platform router</li>
<li>❤ Data &quot;adornment&quot; (Google Doc -&gt; revise it) TABLE
<ol>
<li>First order UI =&gt; URL</li>
<li>Second order UI =&gt; Data</li>
<li>Third order UI =&gt; Streams of events &amp; data</li>
<li>Fourth order UI =&gt; Componentization (<a href="https://github.com/thi-ng/umbrella/blob/a02d7b1dbea4e4a294d238af108d23ec831c1981/packages/transducers/src/func/deep-transform.ts">@thi.ng/hdom</a> <code>spec</code>)</li>
<li>Fith order UI =&gt; component styling (styled-system-hdom)</li>
</ol>
</li>
</ul>
</li>
<li>
<p>streams (FRP Architecture)</p>
<ul>
<li>marble diagram</li>
<li>built-ins (exposed):
<ul>
<li><code>run$</code></li>
<li><code>out$</code></li>
</ul>
</li>
<li>built-ins (under the hood):
<ul>
<li><code>task$</code></li>
<li><code>command$</code></li>
</ul>
</li>
<li>ad-hoc stream attachments
<ul>
<li>SEE ADVANCED SECTION BELOW...</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Commands (synchronous payloads)</p>
<ul>
<li>primary keys: (TABLE)
<ul>
<li><code>sub$</code>: a Topic key for for registering the event</li>
<li><code>args</code>: arguments for the handler of the event</li>
<li><code>path</code>: path/lens for targeted state evolution</li>
</ul>
</li>
<li>built-ins
<ul>
<li>State Evolution: <code>sub$: &quot;STATE&quot;</code>
<ul>
<li>this is where the <code>path</code> key comes into play</li>
</ul>
</li>
<li>Routing: <code>sub$: &quot;ROUTE&quot;</code> (see &quot;Routing&quot; section below)</li>
<li><a href="">FLIP</a> Animations: <code>sub$: &quot;FLIP&quot;</code></li>
</ul>
</li>
<li>Command Registration
<ul>
<li>during registration of a Command, you will only need the primary keys
<ul>
<li><code>sub$</code>: Topic key for for registering the event</li>
<li><code>args</code>: payload (static only) of the event</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Tasks (ordered Command dispatch 💃 asynchronous payloads!)</p>
<ul>
<li>A Task is just an array of Commands, but with some special features:
<ul>
<li>pass data between Commands within a task</li>
<li>use Promises (async) in a Command</li>
<li>(de)compose a Task into/from Subtasks</li>
</ul>
</li>
<li>w/in a Task, dispatcher recognizes two additional keys for dealing with Promises:
<ul>
<li><code>reso</code>: used for handling resolved Promise args</li>
<li><code>erro</code>: used for handling rejected Promise args</li>
</ul>
</li>
<li>dispatcher
<ul>
<li>composition of Commands</li>
<li>&quot;Command <code>args</code> threading&quot;</li>
<li><code>args</code> signature dynamic dispatch:
<ul>
<li>Functions</li>
<li>Objects</li>
<li>Strings|Booleans</li>
</ul>
</li>
</ul>
</li>
<li>forms:
<ul>
<li>formulaic tasks (no outside input)</li>
<li>subtasks (outside input)
<ul>
<li>compose into higher-order tasks or</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>subtasks</p>
</li>
<li>
<p>Routing</p>
<ul>
<li>combine browser API instigated (&quot;popstate&quot;, &quot;DOMContentLoaded&quot;) with user-invoked stream emissions</li>
<li>registered the <code>sub$: &quot;ROUTE&quot;</code> Command</li>
<li><code>route_cfg</code> Object (TABLE)
<ul>
<li>a <a href="http://thi.ng/associative">@thi.ng/associative</a> <code>EquivMap</code> pattern matcher</li>
<li>see [LINK TO DOCS IN CODE CONTEXT 📌 TODO]</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Naming Conventions:</p>
<ul>
<li>constants: <code>CAPITAL_SNAKE_CASE</code>
<ul>
<li>generally accepted convention for constants in JS</li>
<li>used for defining Commands (as though they might cause
side effects, their subscription names are constant -
i.e., a signal for emphasising this aspect of a
Command)</li>
</ul>
</li>
<li>pure functions: <code>snake_case</code>
<ul>
<li>some novelty here due to pure functions acting like
constants in that with the same input they always
return the same output</li>
</ul>
</li>
<li>impure functions: <code>camelCase</code>
<ul>
<li>regular side-effecty JS</li>
</ul>
</li>
<li>Tasks: <code>DOUBLE__UNDERSCORE__SNAKE__CASE</code>
<ul>
<li>implies the inputs and outputs on either end of a Task</li>
<li>Tasks also should be treated as pure functions where
the output is really just data (and lambdas). This is
going in the direction of &quot;code as data&quot;</li>
</ul>
</li>
</ul>
</li>
<li>
<p>lots'o'examples</p>
</li>
<li>
<p>ADVANCED</p>
<ul>
<li>ad-hoc stream injection
<ul>
<li>nullary (thunk) in a Task</li>
</ul>
</li>
<li><code>rendertron</code></li>
</ul>
<!-- Generated by documentation.js. Update this documentation by updating the source code. -->
</li>
</ul>
<h3>Table of Contents</h3>
<ul>
<li>
<ul>
<li><a href="#registercmd">registerCMD</a>
<ul>
<li><a href="#all">all</a>
<ul>
<li><a href="#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#registercmd-1">registerCMD</a>
<ul>
<li><a href="#all-1">all</a>
<ul>
<li><a href="#examples-1">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#registercmd-2">registerCMD</a>
<ul>
<li><a href="#all-2">all</a>
<ul>
<li><a href="#examples-2">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#registercmd-3">registerCMD</a>
<ul>
<li><a href="#all-3">all</a>
<ul>
<li><a href="#examples-3">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#hurler">HURLer</a>
<ul>
<li><a href="#parameters">Parameters</a></li>
</ul>
</li>
<li><a href="#__set_link_attrs_dom">__SET_LINK_ATTRS_DOM</a></li>
<li><a href="#_set_link_attrs_dom">_SET_LINK_ATTRS_DOM</a>
<ul>
<li><a href="#payload-function">Payload: function</a></li>
<li><a href="#handler-side-effecting">Handler: side-effecting</a></li>
</ul>
</li>
<li><a href="#__href_pushstate_dom">__HREF_PUSHSTATE_DOM</a></li>
<li><a href="#_href_pushstate_dom">_HREF_PUSHSTATE_DOM</a>
<ul>
<li><a href="#payload-function-1">Payload: function</a></li>
<li><a href="#handler-side-effecting-1">Handler: side-effecting</a></li>
</ul>
</li>
<li><a href="#__notify_prerender_dom">__NOTIFY_PRERENDER_DOM</a></li>
<li><a href="#_notify_prerender_dom">_NOTIFY_PRERENDER_DOM</a>
<ul>
<li><a href="#payload-static">Payload: static</a></li>
<li><a href="#handler-side-effecting-2">Handler: side-effecting</a></li>
</ul>
</li>
<li><a href="#ogtitle">og:title</a></li>
<li><a href="#flipfirst">FLIPFirst</a>
<ul>
<li><a href="#parameters-1">Parameters</a></li>
</ul>
</li>
<li><a href="#zindex">zIndex</a>
<ul>
<li><a href="#parameters-2">Parameters</a></li>
</ul>
</li>
<li><a href="#fliplastinvertplay">FLIPLastInvertPlay</a>
<ul>
<li><a href="#parameters-3">Parameters</a></li>
</ul>
</li>
<li><a href="#l_flip_map">L_flip_map</a></li>
<li><a href="#state">state</a></li>
<li><a href="#furl">fURL</a></li>
</ul>
</li>
<li><a href="#hrefurl-parser">HREF/URL Parser</a>
<ul>
<li><a href="#examples-4">Examples:</a>
<ul>
<li><a href="#parameters-4">Parameters</a></li>
</ul>
</li>
<li><a href="#unfurl">unfURL</a>
<ul>
<li><a href="#parameters-5">Parameters</a></li>
</ul>
</li>
<li><a href="#stringify_type">stringify_type</a>
<ul>
<li><a href="#stringify_type-1">stringify_type</a></li>
<li><a href="#parameters-6">Parameters</a></li>
</ul>
</li>
<li><a href="#trace">trace$</a></li>
<li><a href="#trace_stream">trace_stream</a>
<ul>
<li><a href="#parameters-7">Parameters</a></li>
</ul>
</li>
<li><a href="#stringify_w_functions">stringify_w_functions</a>
<ul>
<li><a href="#parameters-8">Parameters</a></li>
</ul>
</li>
<li><a href="#x_key_err">x_key_ERR</a>
<ul>
<li><a href="#parameters-9">Parameters</a></li>
</ul>
</li>
<li><a href="#diff_keys">diff_keys</a>
<ul>
<li><a href="#parameters-10">Parameters</a></li>
</ul>
</li>
<li><a href="#registered">registered</a></li>
<li><a href="#registercmd-4">registerCMD</a>
<ul>
<li><a href="#destructuring-behavior">Destructuring Behavior</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#parameters-11">Parameters</a></li>
</ul>
</li>
<li><a href="#error">Error</a></li>
<li><a href="#registerrouterdom">registerRouterDOM</a>
<ul>
<li><a href="#parameters-12">Parameters</a></li>
</ul>
</li>
<li><a href="#boot">boot</a>
<ul>
<li><a href="#parameters-13">Parameters</a></li>
</ul>
</li>
<li><a href="#isobject">isObject</a></li>
<li><a href="#__url__route">__URL__ROUTE</a>
<ul>
<li><a href="#parameters-14">Parameters</a></li>
</ul>
</li>
<li><a href="#erro_">erro_</a></li>
<li><a href="#_set_router_loading_statecod">_SET_ROUTER_LOADING_STATEcod</a>
<ul>
<li><a href="#payload-static-1">Payload: static</a></li>
<li><a href="#handler-side-effecting-3">Handler: side-effecting</a></li>
</ul>
</li>
<li><a href="#args_">args_</a></li>
<li><a href="#_set_router_path">_SET_ROUTER_PATH</a>
<ul>
<li><a href="#payload-function-2">Payload: function</a></li>
<li><a href="#handler-side-effecting-4">Handler: side-effecting</a></li>
</ul>
</li>
<li><a href="#args_-1">args_</a>
<ul>
<li><a href="#handler-side-effecting-5">Handler: side-effecting</a></li>
</ul>
</li>
<li><a href="#__url_dom__route">__URL_DOM__ROUTE</a>
<ul>
<li><a href="#parameters-15">Parameters</a></li>
</ul>
</li>
<li><a href="#streams">Streams</a></li>
<li><a href="#run">run$</a></li>
</ul>
</li>
<li><a href="#stream-architecture">Stream Architecture:</a>
<ul>
<li><a href="#marble-diagram">Marble Diagram</a></li>
<li><a href="#streams-1">Streams</a></li>
<li><a href="#handlers">Handlers</a>
<ul>
<li><a href="#handlers-framework-provided">Handlers (framework provided):</a></li>
</ul>
</li>
<li><a href="#run-1">run$</a></li>
<li><a href="#out">out$</a></li>
<li><a href="#out-1">out$</a></li>
<li><a href="#command">command$</a></li>
<li><a href="#command-1">command$</a></li>
<li><a href="#task">task$</a></li>
<li><a href="#task-1">task$</a></li>
<li><a href="#domnavigated">DOMnavigated$</a></li>
<li><a href="#getting-the-hurl-property-from-the-various-events">getting the hurl property from the various events:</a></li>
<li><a href="#spule">spule</a></li>
<li><a href="#spule-1">spule</a></li>
<li><a href="#spool">spool</a>
<ul>
<li><a href="#tldr">TL;DR:</a></li>
<li><a href="#synopsis">Synopsis:</a></li>
<li><a href="#type-checks-on-function-signatures">Type checks on function signatures</a></li>
</ul>
</li>
<li><a href="#recognized-keys">Recognized Keys</a>
<ul>
<li><a href="#primary-keys">Primary keys</a>
<ul>
<li>
<ul>
<li><a href="#sub-key">sub$ key</a></li>
<li><a href="#args-key">args key</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#promise-specific-keys---binary-as-in-two-parameter">Promise-specific keys -&gt; binary (as in two parameter,</a>
<ul>
<li>
<ul>
<li><a href="#reso-key">reso key</a></li>
<li><a href="#erro-key">erro key</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#subtasks">Subtasks:</a>
<ul>
<li><a href="#pseudo">PSEUDO</a></li>
<li><a href="#example-1">Example</a></li>
<li><a href="#use">Use:</a></li>
</ul>
</li>
<li><a href="#ad-hoc-stream-injection">Ad-hoc stream injection</a></li>
<li><a href="#parameters-16">Parameters</a></li>
</ul>
</li>
<li><a href="#hurl">HURL</a></li>
<li><a href="#err_str">err_str</a>
<ul>
<li><a href="#parameters-17">Parameters</a></li>
</ul>
</li>
<li><a href="#constants">constants</a></li>
<li><a href="#default_cfg">DEFAULT_CFG</a></li>
<li><a href="#atom">Atom</a></li>
<li><a href="#settate">set$$tate</a></li>
<li><a href="#settate-1">set$$tate</a>
<ul>
<li><a href="#parameters-18">Parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>registerCMD</h2>
<h3>all</h3>
<p>enables inspection of the existing Command registrations
if using Chrome, there's an additional advantage of being
able to find the <code>[[FunctionLocation]]</code> of the Command,</p>
<h4>Examples</h4>
<pre class="prettyprint source lang-javascript"><code>registerCMD.all.entries()
// => ⬇ [[Entries]]
//      ⬇ 0: {&quot;HURL_CMD&quot; => Object}
//          key: &quot;HURL_CMD&quot;
//        ⬇ value:
//            sub$: &quot;HURL_CMD&quot;
//          ⬇ args: ev => ev
//              arguments: (...)
//              caller: (...)
//              length: 1
//              name: &quot;args&quot;
//            ➡ __proto__: ƒ ()
//              [[FunctionLocation]]: routing.js:32 (♻ Chrome)
//            ➡ [[Scopes]]: Scopes[2]
</code></pre>
<h2>registerCMD</h2>
<h3>all</h3>
<p>enables inspection of the existing Command registrations
if using Chrome, there's an additional advantage of being
able to find the <code>[[FunctionLocation]]</code> of the Command,</p>
<h4>Examples</h4>
<pre class="prettyprint source lang-javascript"><code>registerCMD.all.entries()
// => ⬇ [[Entries]]
//      ⬇ 0: {&quot;HURL_CMD&quot; => Object}
//          key: &quot;HURL_CMD&quot;
//        ⬇ value:
//            sub$: &quot;HURL_CMD&quot;
//          ⬇ args: ev => ev
//              arguments: (...)
//              caller: (...)
//              length: 1
//              name: &quot;args&quot;
//            ➡ __proto__: ƒ ()
//              [[FunctionLocation]]: routing.js:32 (♻ Chrome)
//            ➡ [[Scopes]]: Scopes[2]
</code></pre>
<h2>registerCMD</h2>
<h3>all</h3>
<p>enables inspection of the existing Command registrations
if using Chrome, there's an additional advantage of being
able to find the <code>[[FunctionLocation]]</code> of the Command,</p>
<h4>Examples</h4>
<pre class="prettyprint source lang-javascript"><code>registerCMD.all.entries()
// => ⬇ [[Entries]]
//      ⬇ 0: {&quot;HURL_CMD&quot; => Object}
//          key: &quot;HURL_CMD&quot;
//        ⬇ value:
//            sub$: &quot;HURL_CMD&quot;
//          ⬇ args: ev => ev
//              arguments: (...)
//              caller: (...)
//              length: 1
//              name: &quot;args&quot;
//            ➡ __proto__: ƒ ()
//              [[FunctionLocation]]: routing.js:32 (♻ Chrome)
//            ➡ [[Scopes]]: Scopes[2]
</code></pre>
<h2>registerCMD</h2>
<h3>all</h3>
<p>enables inspection of the existing Command registrations
if using Chrome, there's an additional advantage of being
able to find the <code>[[FunctionLocation]]</code> of the Command,</p>
<h4>Examples</h4>
<pre class="prettyprint source lang-javascript"><code>registerCMD.all.entries()
// => ⬇ [[Entries]]
//      ⬇ 0: {&quot;HURL_CMD&quot; => Object}
//          key: &quot;HURL_CMD&quot;
//        ⬇ value:
//            sub$: &quot;HURL_CMD&quot;
//          ⬇ args: ev => ev
//              arguments: (...)
//              caller: (...)
//              length: 1
//              name: &quot;args&quot;
//            ➡ __proto__: ƒ ()
//              [[FunctionLocation]]: routing.js:32 (♻ Chrome)
//            ➡ [[Scopes]]: Scopes[2]
</code></pre>
<h2>HURLer</h2>
<p>we need to transform the payload to align with the
object structure of the native DOM events ('popstate'
and 'DOMContentLoaded') payloads, so they're
transformed correctly by the <code>navigated$</code> stream
transforms</p>
<h3>Parameters</h3>
<ul>
<li><code>ev</code></li>
</ul>
<h2>__SET_LINK_ATTRS_DOM</h2>
<h2><code>_SET_LINK_ATTRS_DOM</code></h2>
<p>Routing Command: DOM-specific</p>
<h3>Payload: function</h3>
<p>default payload <code>args</code> signature:</p>
<pre><code>args: ({ DOM }) =&gt; ({ DOM }),
</code></pre>
<p>Input = DOM node reference</p>
<h3>Handler: side-effecting</h3>
<p>Takes a DOM reference and queries all visited links. Sets
current/clicked link as active and sets visted links that
don't match current URL to inactive see <code>setLinkAttrs</code>
function</p>
<h2>__HREF_PUSHSTATE_DOM</h2>
<h2><code>_HREF_PUSHSTATE_DOM</code></h2>
<p>Routing Command: DOM-specific</p>
<h3>Payload: function</h3>
<p>default payload <code>args</code> signature:</p>
<pre><code>args: ({ URL, DOM }) =&gt; ({ URL, DOM }),
</code></pre>
<p>Takes a URL and a DOM reference</p>
<h3>Handler: side-effecting</h3>
<p>If the DOM reference is an <code>&lt;a&gt;</code> element, uses
<code>history.pushState</code> to add the clicked URL (plus the
parsed URL from <code>parse_URL(URL)</code>) to the <code>history</code> object</p>
<p>export const DOMnavigated$ = merge({
src: [popstate$, DOMContentLoaded$]
}).transform(map(x =&gt; ({ URL: x.target.location.href, DOM: x.currentTarget })))</p>
<h2>__NOTIFY_PRERENDER_DOM</h2>
<h2><code>_NOTIFY_PRERENDER_DOM</code></h2>
<h3>Payload: static</h3>
<p>default payload <code>args</code> signature</p>
<pre><code>args: true,
</code></pre>
<h3>Handler: side-effecting</h3>
<p>Routing Command: DOM-specific (used for manually
triggering <code>rendertron</code> prerenderer for bots/web-crawlers</p>
<p>TODO: <code>jsdom</code> prerender testing</p>
<p>basic <code>http</code> server that returns static content for
certain user-agents</p>
<p>import { JSDOM } from &quot;jsdom&quot;</p>
<p>const document = (new JSDOM(...)).window.document
document.addEventListener(&quot;rendered&quot;, () =&gt; {...scrape
stuff here...
})</p>
<h2>og:title</h2>
<p>og:url can tell scrapers to ignore the page and
scrape this instead. Would save scraping the whole
page and might be friendlier for <code>jsdom</code></p>
<h2>FLIPFirst</h2>
<p>order:
normalizeTree -&gt; render -&gt; diff -&gt; init -&gt; release
| hdom |         | dom  | post-dom</p>
<p>have to think backwards:
1. el mounted (init): look for existing flip map for id</p>
<ul>
<li>if exists, Play anim and store new flip map rect (for navs)</li>
<li>if doesn't, nada</li>
</ul>
<ol start="2">
<li>el clicked (render.attrs.onclick): measure and store flip map for id</li>
<li>el released: if clicked, calc flip rect and lookup for id:</li>
</ol>
<ul>
<li>if first === last, no change (on nav e.g.)</li>
<li>if first !== last, nav change (store rect for id)</li>
</ul>
<h3>Parameters</h3>
<ul>
<li><code>$0</code> <strong><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></strong>
<ul>
<li><code>$0.state</code></li>
<li><code>$0.id</code></li>
<li><code>$0.target</code></li>
</ul>
</li>
</ul>
<h2>zIndex</h2>
<p><a href="https://coder-coder.com/z-index-isnt-working/">https://coder-coder.com/z-index-isnt-working/</a></p>
<h3>Parameters</h3>
<ul>
<li><code>el</code></li>
<li><code>idx</code></li>
</ul>
<h2>FLIPLastInvertPlay</h2>
<ol>
<li>
<p>if it has been clicked that means the last thing
that happened was a click that triggered this init
so we do the calcs</p>
</li>
<li>
<p>if a back/nav (no frame) event was what triggered
the init do the calcs with no frame</p>
</li>
</ol>
<h3>Parameters</h3>
<ul>
<li><code>$0</code> <strong><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></strong>
<ul>
<li><code>$0.element</code></li>
<li><code>$0.state</code></li>
<li><code>$0.id</code></li>
<li><code>$0.transition</code>   (optional, default <code>&quot;all .3s cubic-bezier(.54,-0.29,.17,1.11)&quot;</code>)</li>
</ul>
</li>
</ul>
<h2>L_flip_map</h2>
<p>🔥 this may cause issues for parrallel anims append this
to a specific target using:
Array.from(el.querySelectorAll(&quot;[flip]&quot;)).forEach(x=&gt;
if i last... el.scrollIntoView())</p>
<h2>state</h2>
<p>What's happening:</p>
<ul>
<li>on first click (render)</li>
<li>rect registered</li>
<li>frame registered</li>
<li>navs</li>
<li>on init of new DOM</li>
<li>checks for rect &amp; frame</li>
<li>uses rect &amp; frame to calc diff</li>
<li>PLAY</li>
</ul>
<h2>fURL</h2>
<h1>HREF/URL Parser</h1>
<p>Takes an href (full or relative) and pulls out the various
components to be used for instrumentation of various
high-level event handling.</p>
<h2>Examples:</h2>
<p>Ex1:</p>
<pre class="prettyprint source lang-js"><code>parse_href(&quot;http://localhost:1234/about?get=some#today&quot;)
</code></pre>
<pre class="prettyprint source lang-js"><code>{
  URL: &quot;http://localhost:1234/about?get=some#today&quot;,
  URL_subdomain: [],
  URL_domain: [&quot;localhost:1234&quot;],
  URL_path: [&quot;about&quot;],
  URL_query: { get: &quot;some&quot; },
  URL_hash: &quot;today&quot;
}
</code></pre>
<p>Ex2:</p>
<pre class="prettyprint source lang-js"><code>parse_href(&quot;https://github.com/thi-ng/umbrella/#blog-posts&quot;)
</code></pre>
<pre class="prettyprint source lang-js"><code>{
  URL: 'https://github.com/thi-ng/umbrella/#blog-posts',
  URL_subdomain: [],
  URL_domain: [&quot;github&quot;, &quot;com&quot;],
  URL_path: [&quot;thi-ng&quot;, &quot;umbrella&quot;],
  URL_query: {},
  URL_hash: &quot;blog-posts&quot;
}
</code></pre>
<p>Ex3:</p>
<pre class="prettyprint source lang-js"><code>parse_href(&quot;https://very-long-sub.dom.cloud.eu/site/my/happy/&quot;)
</code></pre>
<pre class="prettyprint source lang-js"><code>{
  URL: 'https://very-long-sub.dom.cloud.eu/site/my/happy/',
  URL_subdomain: [&quot;very-long-sub&quot;, &quot;dom&quot;],
  URL_domain: [&quot;cloud&quot;, &quot;eu&quot;],
  URL_path: [&quot;site&quot;, &quot;my&quot;, &quot;happy&quot;],
  URL_query: {},
  URL_hash: &quot;&quot;
}
</code></pre>
<p>Ex4:</p>
<pre class="prettyprint source lang-js"><code>parse_href(&quot;https://api.census.gov/data?get=NAME&in=state:01&in=county:*&quot;)
</code></pre>
<pre class="prettyprint source lang-js"><code>{
  URL: &quot;https://api.census.gov/data?get=NAME&in=state:01&in=county:*&quot;,
  URL_subdomain: [&quot;api&quot;],
  URL_domain: [&quot;census&quot;, &quot;gov&quot;],
  URL_path: [&quot;data&quot;],
  URL_query: { get: &quot;NAME&quot;, in: [&quot;state:01&quot;, &quot;county:*&quot;] },
  URL_hash: &quot;&quot;
}
</code></pre>
<p>Ex5:</p>
<pre class="prettyprint source lang-js"><code>parse_href(&quot;/data?get=NAME&in=state#indeed&quot;)
</code></pre>
<pre class="prettyprint source lang-js"><code>{
  URL: &quot;/data?get=NAME&in=state#indeed&quot;,
  URL_subdomain: [],
  URL_domain: [],
  URL_path: [&quot;data&quot;],
  URL_query: { get: &quot;NAME&quot;, in: &quot;state&quot; },
  URL_hash: &quot;indeed&quot;
}
</code></pre>
<h3>Parameters</h3>
<ul>
<li><code>_URL</code></li>
<li><code>prefixRGX</code></li>
<li><code>URL</code> <strong><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></strong> full or partial URL/href</li>
</ul>
<h2>unfURL</h2>
<p><code>unparse_URL</code></p>
<p>The reverse of <code>parse_URL</code> that enables talking to the
router with a friendlier API than having to always
construct URLs manually.</p>
<p>TODO: testing for <code>unparse_URL</code></p>
<h3>Parameters</h3>
<ul>
<li><code>parsed</code></li>
<li><code>isAbsolute</code>   (optional, default <code>false</code>)</li>
</ul>
<h2>stringify_type</h2>
<h3><code>stringify_type</code></h3>
<p>just a little convenience function
takes some value and returns a string representation of its type
this makes it easier to create a switch statement using types</p>
<p>powered by <a href="http://thi.ng/checks">@thi.ng/checks</a></p>
<h3>Parameters</h3>
<ul>
<li><code>x</code></li>
</ul>
<h2>trace$</h2>
<h2><code>trace_stream</code></h2>
<p>simple ad-hoc tracer to log one of the streams emmissions</p>
<h3>Parameters</h3>
<ul>
<li><code>log_prefix</code> <strong><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></strong> A string that is prepended to
console.log's of emissions from the
stream</li>
<li><code>stream</code></li>
</ul>
<h2>stringify_w_functions</h2>
<p>Uses a JSON.stringify &quot;replacer&quot; function to preserve a
small (truncated) version of the function signature for
Object values that contain them</p>
<h3>Parameters</h3>
<ul>
<li><code>x</code></li>
<li><code>indent</code></li>
</ul>
<h2>x_key_ERR</h2>
<p><code>uknown_key_ERR</code></p>
<p>Just a  little error for people defining commands
that makes sure their keys don't contain typos</p>
<h3>Parameters</h3>
<ul>
<li><code>str</code></li>
<li><code>c</code></li>
<li><code>unknown</code></li>
<li><code>sub$</code></li>
<li><code>index</code></li>
</ul>
<h2>diff_keys</h2>
<h3>Parameters</h3>
<ul>
<li><code>nKeys</code>   (optional, default <code>[]</code>)</li>
<li><code>nObj</code>   (optional, default <code>{}</code>)</li>
</ul>
<h2>registered</h2>
<h2><code>registerCMD</code></h2>
<p>Takes a Command object with some additional information
and returns a Command usable in a Task or as-is. This
also serves the additional benefit of giving the user a
constant to use instead of making any typos in keys
during use.</p>
<h3>Destructuring Behavior</h3>
<p>During a <code>sub$</code> registration, the keys in the Command
object are used to determine the signature of incoming
Commands. In order to reduce the amount of boilerplate
for Commands that only contain the <code>sub$</code> and <code>args</code> key,
the <code>args</code> key is
<a href="https://github.com/thi-ng/umbrella/blob/master/packages/transducers/src/xform/pluck.ts">pluck</a>ed
from the incoming Commands. This pulls the <code>args</code> value
out from the incoming Command objects to be used directly
(without the need for dstructuring).</p>
<h3>Example</h3>
<pre class="prettyprint source lang-js"><code>import { registerCMD, run$ } from &quot;🍎&quot;

const cmd_pathless = {
  sub$: &quot;PATHLESS&quot;,
  args: { static: &quot;payload&quot; }
}

const pathless_handler = x => console.log(&quot;pathless ->&quot;, x)

const CMD_PATHLESS = registerCMD(cmd_pathless, pathless_handler)

run$.next(CMD_PATHLESS) // 🏃
// pathless -> { static: 'payload' }

const cmd_path = {
  sub$: &quot;PATH&quot;,
  args: { static: &quot;payload&quot; },
  path: [&quot;default&quot;, &quot;path&quot;]
}

const path_handler = x => console.log(&quot;path ->&quot;, x)

const CMD_PATH = registerCMD(cmd_path, path_handler)

run$.next(CMD_PATH) // 🏃
// path -> { args: { static: 'payload' }, path: [ 'default', 'path' ] }

const test_pathless = {
  sub$: &quot;PATHLESS&quot;,
  args: &quot;🔥&quot;
}

run$.next(test_pathless) // 🏃
// pathless -> &quot;🔥&quot;
// as you can see, the Command args have been plucked out

const test_path = {
  sub$: &quot;PATH&quot;,
  args: &quot;🌊&quot;,
  path: [&quot;new&quot;, &quot;path&quot;]
}

run$.next(test_path) // 🏃
// path -> { args: '🌊', path: [ 'new', 'path' ] }
// only the sub$ entry has been removed leaving the rest

// NOW: Let's stick these into a Task
let TASK_1 = [
  { ...CMD_PATH, path: &quot;overwritten&quot; },
  CMD_PATHLESS,
  { ...test_path, args: &quot;🍝&quot; }
]
run$.next(TASK_1)
// path -> { args: { static: 'payload' }, path: 'overwritten' }
// pathless -> { static: 'payload' }
// path -> { args: '🍝', path: [ 'new', 'path' ] }
</code></pre>
<h3>Parameters</h3>
<ul>
<li><code>command</code> <strong>Command</strong> an object with four keys:
1. <code>sub$</code> (required)
2. <code>handler</code> (required)
3. <code>args</code> (optional, sets default) during registration
4. <code>source$</code> (optional, enables stream to feed Command)</li>
</ul>
<h2>Error</h2>
<p>destructure the args component out of the emissions
to save the user from having to do that PITA everytime</p>
<h2>registerRouterDOM</h2>
<p>expects payload of</p>
<pre><code>{ target: { location: { href } }, currentTarget }
</code></pre>
<h3>Parameters</h3>
<ul>
<li><code>router</code></li>
</ul>
<h2>boot</h2>
<p>Part I: Needs to be a functional component to accept the
<code>ctx</code> object to pass it to children</p>
<p>Part II: Takes the root RAF stream and updates the shell
on every global state mutation</p>
<p>Part III: Connects the app shell to the state stream,
which is triggered by any updates to the global
<code>$store$</code></p>
<h3>Parameters</h3>
<ul>
<li><code>CFG</code></li>
</ul>
<h2>isObject</h2>
<h2>__URL__ROUTE</h2>
<p><code>_URL__ROUTE</code></p>
<p>Universal router (cross-platform) Subtask.</p>
<p>This can be used in both a browser and Node context. The
parts that handle browser side-effects are included in an
Supertask <code>_URL__ROUTE</code></p>
<p>Pseudo</p>
<pre><code>( router ) =&gt; ({ URL }) =&gt; [
- set `router_loading` path in global atom to `true`
- call provided `router` with the `URL` and await payload
- `parse_URL(URL)` for `URL_*` components
- set `route_path` in global store/atom to current `URL_path`
- set page state (data, path &amp; page component name) in store
- once promise(s) resolved, set `router_loading` to `false`
]
</code></pre>
<p>reserved Command keys:</p>
<ul>
<li><code>URL_page</code></li>
<li><code>URL_data</code></li>
<li><code>URL_path</code></li>
<li><code>URL</code></li>
<li><code>DOM</code></li>
</ul>
<h3>Parameters</h3>
<ul>
<li><code>CFG</code></li>
</ul>
<h2>erro_</h2>
<h2><code>_SET_ROUTER_LOADING_STATE</code>cod</h2>
<p>Routing Command: Universal</p>
<h3>Payload: static</h3>
<p>default payload <code>args</code> signature:</p>
<pre><code>args: true,
</code></pre>
<p>Simple true or false payload to alert handler</p>
<h3>Handler: side-effecting</h3>
<p>Sets <code>route_loading</code> path in global Atom to true || false</p>
<h2>args_</h2>
<h2><code>_SET_ROUTER_PATH</code></h2>
<p>Routing Command: Universal</p>
<h3>Payload: function</h3>
<p>default payload <code>args</code> signature:</p>
<pre><code>args: ({ URL_path }) =&gt; ({ URL_path }),
</code></pre>
<p>Consumes the <code>URL_path</code> property from a <code>parse_URL</code>
object, handed off from a prior Command</p>
<h3>Handler: side-effecting</h3>
<p>Sets the current/loading router's <code>route_path</code> in the
global Atom</p>
<h2>args_</h2>
<p>takes the result from two sources: the user-provided
<code>router</code> (<a href="http://thi.ng/associative">@thi.ng/associative:
EquivMap</a>) and the <code>URL_path</code>
from <code>parse_URL(URL)</code></p>
<h3>Handler: side-effecting</h3>
<p>Hydrates the page state as well as the name of the active
page in the global store</p>
<h2>__URL_DOM__ROUTE</h2>
<p><code>_URL__ROUTE_DOM</code></p>
<p>DOM Router that contains a cross-platform routing Subtask
<code>_URL__ROUTE</code></p>
<p>Subtask HOF for router registration. Takes a
<code>@thi.ng/associative</code> <code>EquivMap</code> route matching function,
registers that router as a member of a Task for following
Commands to leverage the returned data (<code>{ data, page }</code>)</p>
<p>Pseudo</p>
<pre><code>( router ) =&gt; ({ URL, DOM event }) =&gt; [
- if href, push to `history.pushState`
- SUBTASK: _URL__ROUTE (universal router)
- remove `active` attribute from visited links except current
- notify rendertron (TBD) of new page
]
</code></pre>
<p>reserved Command keys:</p>
<ul>
<li><code>URL</code></li>
<li><code>DOM</code></li>
<li><code>URL_page</code></li>
<li><code>URL_path</code></li>
<li><code>URL_data</code></li>
</ul>
<h3>Parameters</h3>
<ul>
<li><code>CFG</code></li>
</ul>
<h2>Streams</h2>
<h2>run$</h2>
<h1>Stream Architecture:</h1>
<p><code>run$</code> is the primary event stream exposed to the user
via the <code>ctx</code> object injected into every <code>hdom</code> component
the command stream is the only way the user changes
anything in <code>hurl</code></p>
<h2>Marble Diagram</h2>
<pre><code>0&gt;- |------c-----------c--[~a~b~a~]-a----c-&gt; : calls
1&gt;- |ps|---1-----------1----------0-1----1-&gt; : run$
2&gt;- |t0|---------a~~b~~~~~~~~~~~a~*--------&gt; : task$
3&gt;- |t1|---c-----------c------------a----c-&gt; : command$
4&gt;- ---|ps|c-----a--b--c--------a---a----c-&gt; : out$
Handlers
a&gt;- ---|ta|------*--------------*---*------&gt; : registerCMD
b&gt;- ---|tb|---------*----------------------&gt; : registerCMD
c&gt;- ---|tc|*-----------*-----------------*-&gt; : registerCMD
</code></pre>
<h2>Streams</h2>
<ul>
<li><code>0&gt;-</code>: <code>ctx.run$.next(x)</code> userland dispatches</li>
<li><code>1&gt;-</code>: <code>pubsub({ topic: x =&gt; x.length === 0 })</code> <code>run$</code>
stream</li>
<li><code>2&gt;-</code>: pubsub = <code>false</code> ? -&gt; <code>task$</code> stream</li>
<li><code>3&gt;-</code>: pubsub = <code>true</code> ? -&gt;<code>command$</code> stream</li>
<li><code>4&gt;-</code>: <code>pubsub({ topic: x =&gt; x.sub$ })</code>: <code>out$</code> stream
-&gt; <code>register_command</code></li>
</ul>
<h2>Handlers</h2>
<p><code>4&gt;-</code> this is the stream to which the user (and
framework) attaches handlers. Handlers receive events
they subscribe to as topics based on a <code>sub$</code> key in a
Command object.</p>
<h3>Handlers (framework provided):</h3>
<ul>
<li>&quot;state&quot;: Global state mutations</li>
<li>&quot;route&quot;: Routing</li>
<li>&quot;FLIP&quot; :
<a href="https://aerotwist.com/blog/flip-your-animations/">F.L.I.P.</a>
animations</li>
</ul>
<p>TODO:</p>
<ul>
<li>add <strong>Examples</strong></li>
<li>add <code>beforeunload</code> event handler within #4 (orphan):
SEE <a href="https://youtu.be/QQukWZcIptM">https://youtu.be/QQukWZcIptM</a></li>
<li>enable ctx.run.cancel() via external or internal events
(e.g., popstate / { sub$:  &quot;cancel&quot; })</li>
</ul>
<h2><code>run$</code></h2>
<p>User-land event dispatch stream</p>
<p>This stream is directly exposed to users via <code>ctx</code> Any
one-off Commands <code>next</code>ed into this stream are sent to
the <code>command$</code> stream. Arrays of Commands (Tasks) are
sent to the <code>task$</code> stream.</p>
<h2>out$</h2>
<h2><code>out$</code></h2>
<p>Primary user-land <em>READ</em> stream. For attaching handlers
for responding to emmitted Commands</p>
<h2>command$</h2>
<h2><code>command$</code></h2>
<p>Primary fork/bisect stream for indivual commands.
attached to a <code>pubsub</code> stemming from this stream. The
<code>topic</code> function used to alert downstream handlers is a
simple lookup of the <code>sub$</code> key of the command</p>
<h2>task$</h2>
<h2><code>task$</code></h2>
<p>Batch processing stream, listens for Tasks sent as an
array of Commands (including subtask functions)</p>
<p>stream (if array of event objects)</p>
<h2>DOMnavigated$</h2>
<p>There are three types of navigation we need to handle:
1. DOMContentLoaded (entering the site) events
2. popstate (browser back/forward button clicks) events
3. <code>&lt;a hurl=&quot;x&quot;&gt;</code> (link clicking)</p>
<p>These events have different payloads and need to be
harmonized in order to use them consistently</p>
<h2>getting the <code>hurl</code> property from the various events:</h2>
<ol>
<li>ev.target.location.hurl</li>
<li>ev.target.location.hurl</li>
<li>ev.target.hurl</li>
</ol>
<p>for raw events, we can just transform them, but for link
clicking we need to convert/wrap it to align with the
destructuring of the others</p>
<p>see _HURL in <code>/commands/routing.js</code> for ad-hoc stream
injection example</p>
<h2>spule</h2>
<h2>spule</h2>
<h2><code>spool</code></h2>
<h3>TL;DR:</h3>
<p>Handles Collections (array) of Commands (&quot;Tasks&quot;) which
require <em>ordered</em> choreography and/or have a dependency
on some (a)sync data produced by a user interaction.</p>
<h3>Synopsis:</h3>
<ul>
<li>Async <code>reduce</code> function, that passes an accumulator
(<code>acc</code>) as a local state container between Command
invocations.</li>
<li>Commands are composed in-situ in userland (Ad hoc)</li>
<li>spools a collection of Commands as a Task</li>
<li>resolves any promises contained within a Command</li>
<li>passes an accumulator (acc) to subsequent Commands in a
Task</li>
</ul>
<h3>Type checks on function signatures</h3>
<p>There are two valid forms for Task entries:
1. a Unary function returning an array of Commands:
referred to as &quot;Subtasks&quot;
2. A Command object: dispatch to registered handlers</p>
<h2>Recognized Keys</h2>
<p>There are 4 recognized keys for a Command object:</p>
<h3>Primary keys</h3>
<h5><code>sub$</code> key</h5>
<ul>
<li>Topic identifier: used for registering handlers hooked
onto the Command stream.</li>
</ul>
<h5><code>args</code> key</h5>
<ul>
<li><strong>primary control structure</strong> with three recognized
forms that do different things in the context of a
Task:</li>
<li>non-function <code>args</code> (primitives, objects) send the args
as-is to the Command handler</li>
<li>nullary fns (<code>(0)=&gt;</code> ) send the args_ as a Command to
a <code>sub$</code> _stream_ of your choosing (ADVANCED: see
Ad-hoc Stream Injection below)</li>
<li>unary fns (<code>(1)=&gt;</code>) are passed the inter-Task
accumulated value, called and the resulting value is
passed to registered Command handler</li>
<li>Promises (and those returned from <code>(1)=&gt;</code>) are resolved
and their values sent to the handler</li>
<li>new vals (Objects) are merged with accumulated object
from preceding Task results(dupe keys overwritten)</li>
</ul>
<h3>Promise-specific keys -&gt; binary (as in two parameter,</h3>
<p>not boolean) functions:</p>
<h5><code>reso</code> key</h5>
<ul>
<li>(resolving) function <code>(2)=&gt;</code> = handle resolved
promises: MUST be a binary fn <code>(acc, resolved Promise) =&gt;</code></li>
</ul>
<h5><code>erro</code> key</h5>
<ul>
<li><code>(2)=&gt;</code> = handle rejected promises: MUST be
a binary fn <code>(acc, Promise rejection) =&gt;</code></li>
</ul>
<h3>Subtasks:</h3>
<p>Subtasks are the way you compose tasks. Insert a Task and
the spool will unpack it in place (super -&gt; sub
order preserved) A Subtask must be defined as a unary
function that accepts an accumulator object and returns a
Task, e.g.:</p>
<h4>PSEUDO</h4>
<pre class="prettyprint source lang-js"><code>// { C: Command }
// ( { A: Accumulator }: Object ) => [{C},{C}]: Subtask
let someSubtask = ({A}) => [{C}, {C}, ({A})=>[{C},{C}], ...]
</code></pre>
<h4>Example</h4>
<pre class="prettyprint source lang-js"><code>// subtask example:
let subtask1 = acc => [
 { sub$: &quot;acc&quot;
 , args: { data: acc.data } },
 { sub$: &quot;route&quot;
 , args: { route: { href: acc.href } } }
]

// task
let task = [
 { args: { href: &quot;https://my.io/todos&quot; } }, // acc init
 { sub$: &quot;fetch&quot;
 , args: ({ href }) => fetch(href).then(r => r.json())
 , erro: (acc, err) => ({ sub$: &quot;cancel&quot;, args: err })
 , reso: (acc, res) => ({ data: res }) },
 acc => subtask1(acc), // subtask reference
 { sub$: &quot;FLIP&quot; , args: &quot;done&quot; }
]
</code></pre>
<h4>Use:</h4>
<pre class="prettyprint source lang-js"><code>import { run$ } from &quot;hurl&quot;

export const run = e => run$.next(e);

//... 📌 TODO...
</code></pre>
<h3>Ad-hoc stream injection</h3>
<p>ADVANCED USE ONLY 👽</p>
<p>HURL tries to hide the stream implentation from the user
as much as possible, but allows you to go further down
the rabbit hole if so desired. You may send Commands to a
separate stream of your own creation during a Task by
using a nullary (&quot;thunk&quot;) <code>(0)=&gt;</code> function signature as
the <code>args</code> value of a Command. If this is the case, the
spool assumes the <code>sub$</code> key references a stream and
sends the return value of the thunk to that stream</p>
<blockquote>
<p>Note: if you need to pass the accumulator to your
thunk, put it in a subtask, where you can
access/destructure the data from the acc passed into the
subtask function</p>
</blockquote>
<pre class="prettyprint source lang-js"><code>import { stream, trace } from &quot;@thi.ng/rstream&quot;

// ad-hoc stream
let login = stream().subscribe(trace(&quot;login ->&quot;))

// task
let task = [
 { args: { href: &quot;https://my.io/auth&quot; } }, // &lt;- no sub$, just pass data
 { sub$: login , args: () => &quot;logging in...&quot; },
 { sub$: &quot;AUTH&quot;
 , args: ({ href }) => fetch(href).then(r => r.json())
 , erro: (acc, err) => ({ sub$: &quot;cancel&quot;, args: err })
 , reso: (acc, res) => ({ token: res }) },
 acc => subtask_login(acc),
 { sub$: login , args: () => &quot;log in success&quot; }
]

// subtask
let subtask_login = ({ token }) => [
 { sub$: login // &lt;- stream
 , args: () => ({ token }) } // &lt;- use acc
]
</code></pre>
<p>*</p>
<h3>Parameters</h3>
<ul>
<li><code>task_array</code></li>
</ul>
<h2>HURL</h2>
<h2>err_str</h2>
<p>There're only 3 lifecycle hooks. render is called for
every update and is just providing the actual hiccup for
that component. if that component is used the first time,
the order is normalizeTree -&gt;  render -&gt; diff -&gt;  init.
The actual DOM element is only known when init is called,
NEVER during render (though you could cache it as local
component state). If during diffing it turns out the
component is not used anymore, then release will be
called</p>
<p>if the object identity of your life cycle component
changes with every update then that count as full
replacement and would trigger init each time:</p>
<p><a href="https://github.com/thi-ng/umbrella/wiki/Higher-order-components">https://github.com/thi-ng/umbrella/wiki/Higher-order-components</a></p>
<p>init is called in so called &quot;post-order&quot;, i.e. when it
executes all children are already present in the DOM (and
might have had their init hooks called) first time = 1st
frame the component appears in the DOM</p>
<h3>Parameters</h3>
<ul>
<li><code>prop</code></li>
</ul>
<h2>constants</h2>
<h2>DEFAULT_CFG</h2>
<p>parse_URL constants</p>
<table>
<thead>
<tr>
<th>URL component key</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>DOM</td>
<td>DOM node target</td>
</tr>
<tr>
<td>URL</td>
<td>full URL/route</td>
</tr>
<tr>
<td>URL_path</td>
<td>route path as array</td>
</tr>
<tr>
<td>URL_domain</td>
<td>top-level domain as array</td>
</tr>
<tr>
<td>URL_subdomain</td>
<td>subdomain as array</td>
</tr>
<tr>
<td>URL_query</td>
<td>node querystring parsed URL parameters</td>
</tr>
<tr>
<td>URL_hash</td>
<td>hash string to/from URL if any</td>
</tr>
<tr>
<td>URL_data</td>
<td>data returned by router</td>
</tr>
<tr>
<td>URL_page</td>
<td>page component to render URL_data with</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>router config key</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>HEAD</td>
<td>metadata wrapper for router (targets DOM <head>)</td>
</tr>
<tr>
<td>BODY</td>
<td>data wrapper for router</td>
</tr>
<tr>
<td>prep</td>
<td>pre-router behavior Task/Command injection</td>
</tr>
<tr>
<td>post</td>
<td>post=router behavior Task/Command injection</td>
</tr>
<tr>
<td>prefix</td>
<td>URL path string for the router to ignore</td>
</tr>
<tr>
<td>router</td>
<td>@thi.ng/EquivMap pattern matching function</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Command key</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sub$</td>
<td>Command primary/unique key (topic subscription)</td>
</tr>
<tr>
<td>args</td>
<td>multiple signature intra-Task Command state see <a href="">Spule</a></td>
</tr>
<tr>
<td>reso</td>
<td>intra-Command resolver of Promise args</td>
</tr>
<tr>
<td>erro</td>
<td>intra-Command handler for Promise args rejetions</td>
</tr>
<tr>
<td>handler</td>
<td>where Commands' actual &quot;work&quot; is done (side-fx/mutations)</td>
</tr>
<tr>
<td>source$</td>
<td>upstream (source stream) Command connector</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>boot config key</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>run</td>
<td>primary userland dispatch function</td>
</tr>
<tr>
<td>state</td>
<td>global immutable state container</td>
</tr>
<tr>
<td>root</td>
<td>DOM mount node for application</td>
</tr>
<tr>
<td>app</td>
<td>root application view</td>
</tr>
<tr>
<td>trace</td>
<td>enable logging of every global state update</td>
</tr>
<tr>
<td>draft</td>
<td>state shape scaffolding</td>
</tr>
</tbody>
</table>
<h2>Atom</h2>
<h2>set$$tate</h2>
<h2><code>set$$tate</code></h2>
<p>Swaps the current value at the given path/lens into the
global store with that of the given value. Checks to see
if that value should be either spread into an existing
object or a complete replacement</p>
<h3>Parameters</h3>
<ul>
<li><code>path</code></li>
<li><code>val</code></li>
</ul>
    </article>
  </section>


    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>